---
import IndexPage from "../../layouts/IndexPage.astro";
import { formatDate } from "../../utils/formatDate";
import { sortPostsByDate } from "../../utils/sortPostsByDate";
import getPostsByTag from "../../utils/getPostsByTag";
import { getAllContent } from "../../utils/getAllContent";

let allPosts = await getAllContent();
let mediations = getPostsByTag(allPosts, "mediations");
let sortedMediations = await sortPostsByDate(mediations);

---

<IndexPage frontmatter={{ comment: false, title: "Mediations Newsletter" }}>
  <h1 class="text-3xl mb-5 mt-10">Mediations Newsletter</h1>
  <p>Timeless insights into humans, software, and leadership.</p>
  <p class="mt-5">Join hundreds of subscribers and learn how to live fully, feel accomplished and get your job done.</p>

  <form name="newsletter-subscription"  class="mt-10" netlify-honeypot="bot-field" netlify>
    <p>
      <p class="mb-5">Every second Tuesday. For free.</p>

      <input
      type="email"
      name="email"
      placeholder="contact@candost.blog"
      class="font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 border focus:outline-none dark:focus:ring-primary-blue"
      style="color:black">

      <button
      type="submit"
      class="bg-primary-yellow hover:bg-primary-blue focus:ring-4 focus:ring-primary-blue font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-primary-yellow dark:hover:bg-primary-green focus:outline-none dark:focus:ring-primary-blue"
      style="color: rgb(62, 51, 85, 1);">
      Try it
    </button>
  </p>
</form>
<div>
  <ul>

    {
      sortedMediations
      .map((post) => (
      <li style="list-style-type: disc;" class="ml-4 my-2">
        <a class="flex text-l" href={post.collection == 'posts' ? '/' + post.slug : '/' + post.collection + '/' + post.slug}>
          <span class="mr-5 text-l hover:none hover:none">{formatDate(post.data.date)} </span>
          <span class="underline-offset-4 cursor-pointer decoration-skin-base decoration-wavy hover:underline hover:decoration-sky-500"><strong>{post.data.newsletterName} #{post.data.issueNumber}:&nbsp;</strong>{post.data.title}</span>
        </a>
      </li>
      )
      )}
    </ul>
  </div>
  <div>
    <p class="italic text-sm">You can also get new letters to your favorite RSS reader via <a class="truncate cursor-pointr mt-1 header-link-active hover:text-skin-active" href="/newsletter/rss.xml">the dedicated RSS feed</a>.</p>
    <div class="divider-horizontal"/>
    <p class="mb-10 mt-10 text-sm">I used to write another newsletter called Mektup. If you want to find the archives,  <a class="underline-offset-4 cursor-pointer decoration-skin-base decoration-wavy hover:underline hover:decoration-sky-500" href="/mektup/">click here.</a></p>
  </div>
</IndexPage>
